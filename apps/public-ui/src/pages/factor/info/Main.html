{#if form}
<form>
	<div class="pure-control-group">
		<Text
						field="{form.fields.name}"
		></Text>
	</div>

	<IconBlock
					fieldGroup="{form.fields.color}"
					on:select="selectColor($routeParams)"
	>
		<div slot="icon">
			<ColorIcon></ColorIcon>
		</div>
		<div
						class:colorSelection="color.valid"
						slot="text"
						style="
                    background-color: {selectedColor};
                "
		>
			{#if !color.valid}
			{color.text.label}
			{/if}
		</div>
	</IconBlock>

	<IconBlock
					fieldGroup="{form.fields.topPosition}"
					on:select="selectPosition('top', $routeParams)"
	>
		<div slot="icon">
			<PositionIcon></PositionIcon>
		</div>
		<div slot="text">
			{#if topPosition.valid}
			{topPosition.fields.name.value}
			{:else}
			{topPosition.text.label}
			{/if}
		</div>
	</IconBlock>

	<IconBlock
					fieldGroup="{form.fields.bottomPosition}"
					on:select="selectPosition('bottom', $routeParams)"
	>
		<div slot="icon">
			<PositionIcon
							inverse="Y"
			></PositionIcon>
		</div>
		<div slot="text">
			{#if bottomPosition.valid}
			{bottomPosition.fields.name.value}
			{:else}
			{bottomPosition.text.label}
			{/if}
		</div>
	</IconBlock>

	<nav class="pure-controls">
		<RightButton
						classes="submitButton"
						highlightColor="{submitHighlight}"
						on:select="select($routeParams)"
		></RightButton>
	</nav>
</form>
{/if}

<script>
	import RightButton    from '../../../common/control/button/RightButton.html'
	import IconBlock      from '../../../common/field/IconBlock.html'
	import Text           from '../../../common/field/Text.html'
	import ColorIcon      from '../../../common/icon/ColorIcon.html'
	import PositionIcon  from '../../../common/icon/PositionIcon.html'
	import * as formCache from '../../../form/cache'
	import * as forms     from '../../../form/forms'
	import * as routes    from '../../../routes'
	import store          from '../../../store'

	export default {
		components: {
			ColorIcon,
			PositionIcon,
			IconBlock,
			RightButton,
			Text
		},
		computed: {
			bottomPosition: ({form}) => form
				? form.fields.bottomPosition
				: null,
			color: ({form}) => form
				? form.fields.color
				: null,
			selectedColor: ({color}) => {
				if (!color || !color.valid) {
					return 'initial'
				}
				const value = color.value.picker

				return `rgb(${value.red}, ${value.green}, ${value.blue})`
			},
			submitHighlight: ({isValid}) => isValid
				? '0b0'
				: 'b00',
			topPosition: ({form}) => form
				? form.fields.topPosition
				: null
		},
		methods: {
			select($routeParams) {
				this.set({keepPollId: $routeParams.pollId})
				forms.navigateOnValid(this, routes.POLL_INFO_MAIN, $routeParams)
			},
			selectColor($routeParams) {
				this.set({keepPollId: $routeParams.pollId})
				routes.navigateToPage(routes.FACTOR_PICK_COLOR, $routeParams)
			},
			selectPosition(
				positionPrefix,
				$routeParams
			) {
				this.set({keepPollId: $routeParams.pollId})
				const factorForm = this.get().form
				forms.setForm(forms.CREATE_POSITION, factorForm.fields[positionPrefix + 'Position'])
				routes.navigateToPage(routes.POSITION_INFO_MAIN, $routeParams)
			}
		},
		oncreate() {
			formCache.getPollRouteParams(this)
			forms.ensureTopForm(
				forms.CREATE_FACTOR,
				this, routes.POLL_INFO_MAIN)
			this.store.set({
				pageTitle: 'Factor Info'
			})
		},
		ondestroy() {
			formCache.savePollForm(this)
			forms.clearForm(this)
		},
		store: () => store
	}
</script>