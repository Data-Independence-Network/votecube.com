{#if form}
<form>
	<div class="pure-control-group">
		<AutoComplete
				field="{form.fields.theme}"
		></AutoComplete>
	</div>
	<div class="pure-control-group">
		<MultiSelect
				field="{form.fields.labels}"
		></MultiSelect>
	</div>
</form>
<table>
	{#each factors as factor}
	<ListItem
			factor="{factor}"
	></ListItem>
	{/each}
</table>
<!--
<VirtualList items={factors} component={ListItem} />
-->
{/if}

<style>
	table {
		width: 100%;
	}
</style>
<script>
	import {FACTOR_DAO}         from '@votecube/public-db'
	// import VirtualList from '@sveltejs/svelte-virtual-list';
	import AutoComplete         from '../../../common/field/AutoComplete.svelte'
	import MultiSelect          from '../../../common/field/MultiSelect.html'
	import {
		clearForm,
		ensureForm,
		navigateOnValid
	}                           from '@votecube/public-logic/src/form/forms'
	import {loadForms}          from '../../../libs/forms'
	import {FACTOR_SEARCH_LIST} from '../../../routes'
	import store                from '../../../store'
	import ListItem             from './ListItem.html'

	export default {
		components: {
			AutoComplete,
			ListItem,
			MultiSelect,
			// VirtualList
		},
		// data() {
		//   return {
		//     ListItem
		//   }
		// },
		methods: {
			submit() {
				navigateOnValid(this, FACTOR_SEARCH_LIST)
			}
		},
		oncreate() {
			loadPage(this).then()
		},
		ondestroy() {
			clearForm(this)
		},
		store: () => store
	}

	async function loadPage(page) {
		const factorDao  = await DI.get(FACTOR_DAO)
		const filterForm = await initForm(page)

		const factors = await factorDao.getAll()

		page.set({factors})
		ensureForm(filterForm, this)
	}

	async function initForm(page) {
		const {FieldGroup, OptionsField, Validators} = await loadForms(page)

		const filter = new FieldGroup('List', {
			theme: new OptionsField([
				// Validators.required()
			], [{
				id: 1,
				text: 'Politics'
			}, {
				id: 2,
				text: 'Culture'
			}, {
				id: 3,
				text: 'Technology'
			}, {
				id: 4,
				text: 'Space'
			}, {
				id: 5,
				text: 'Security'
			}]),
			labels: new OptionsField([], [{
				id: 1,
				text: 'Trump',
				theme: {
					id: 1
				}
			}, {
				id: 2,
				text: 'Integration',
				theme: {
					id: 1
				}
			}], {
				multi: true
			})
		}, [], page.store.get().text.UI.Factor)

	}
</script>
