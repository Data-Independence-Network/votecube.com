{#if form}
<form class="pure-form pure-form-stacked">
    <fieldset>
        <legend>Create Poll</legend>
        <Text
            field="{form.fields.name}"
        ></Text>
        <IconBlock
            field="{form.fields.location}"
            on:select="selectLocation()"
        >
            <div slot="icon">
                <LocationIcon
                    width="42"
                ></LocationIcon>
            </div>
            <div slot="text">
            Poll Location
            </div>
        </IconBlock>
        <IconBlock
            field="{form.fields.timeframe}"
            on:select="selectDates()"
        >
            <div slot="icon">
                <TimeIcon></TimeIcon>
            </div>
            <div slot="text">
            Poll Timeframe
            </div>
        </IconBlock>

        <nav class="pure-controls">
            <RightButton
                circleRadius="23"
                fillColor="ffffff"
                highlightColor="000000"
                strokeWidth="3"
            ></RightButton>
        </nav>
    </fieldset>
</form>
{/if}

<style>

    legend {
            display: none;
    }

    nav {
        bottom: 10px;
        position: absolute;
        text-align: center;
        width: calc(100% - 10px);
    }

</style>

<script>
import RightButton from '../../../common/control/button/RightButton.html'
import Text from '../../../common/field/Text.html'
import IconBlock from '../../../common/field/IconBlock.html'
import LocationIcon from '../../../common/icon/LocationIcon.html'
import TimeIcon from '../../../common/icon/TimeIcon.html'
import {loadForms} from '../../../libs/forms'
import {loadUi} from '../../../libs/text/ui'
import * as routes from '../../../routes'
import store from '../../../store'

export default {
    components: {
        IconBlock,
        LocationIcon,
        RightButton,
        Text,
        TimeIcon
    },
    computed: {
        name: ({test}) => true
    },
    data() {
        return {
            poll: {
                name: ''
            }
        }
    },
    methods: {
        createPoll() {
            const poll = this.get().poll
            const form = this.get().form
            if(!poll.name) {
                return;
            }
        },
        selectDates() {
            routes.navigateToPage(routes.SELECT_POLL_DATES)
        },
        selectLocation() {
            routes.navigateToPage(routes.SELECT_POLL_LOCATION)
        }
    },
    oncreate() {
        Promise.all([
            loadForms(this),
            loadUi(this.store, 'en-us')
        ]).then(([
            {Field, FieldGroup, Validators},
            _
        ]) => {
            const text = this.store.get().text
            const startDate = new DateField([
                Validators.required(),
                Validators.minTomorrow()
            ])
            const dates = new FieldGroup('Dates', {
                startDate,
                endDate: new DateField([
                    Validators.required(),
                    Validators.minTomorrow(),
                    Validators.greaterThanOrEquals(startDate)
                ]),
            }, [], this, text.UI.Poll.Create)

            const continents = new OptionsField([
                    Validators.required()
                ], locations.continents)
            const countries = new OptionsField([
                ], locations.countries)
            const states = new OptionsField([
                ], locations.states)
            const cities = new OptionsField([
                ], locations.cities)
            const location = new FieldGroup('Location', {
                continents,
                countries,
                states,
                cities,
            }, [], this, text.UI.Poll.Create)

            const form = new FieldGroup('NameLocationDates', {
                location,
                name: new Field([
                    Validators.minLength(3),
                    Validators.required()
                ], { maxLength: 40}),
                dates
            }, [], this, this.store.get().text.UI.Poll.Create)
            this.set({form})
        })
    },
    store: () => store
}
</script>
