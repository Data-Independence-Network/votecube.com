{#if vote}
<article>
	<main
			class:offToRight="!$verticalLayout"
	>
		<ChoiceRanking
				delta="{delta}"
				poll="{poll}"
				vote="{vote}"
		></ChoiceRanking>
	</main>
	<table
			class="{$verticalLayout ? 'bottom-factor-table' : 'right-factor-table'}"
			class:leftViewport="!$verticalLayout"
	>
		<tr>
			{#if $verticalLayout}
			<td
			>
				<FactorInfoButton
						axis='x'
						delta="{delta}"
						mode="page"
						on:toggle="toggleSurface('x')"
						poll="{poll}"
						voteDim="{vote.x}"
				></FactorInfoButton>
			</td>
			<td
			>
				<FactorInfoButton
						axis='y'
						delta="{delta}"
						mode="page"
						on:toggle="toggleSurface('y')"
						poll="{poll}"
						voteDim="{vote.y}"
				></FactorInfoButton>
			</td>
			<td>
				<FactorInfoButton
						axis='z'
						delta="{delta}"
						mode="page"
						on:toggle="toggleSurface('z')"
						poll="{poll}"
						voteDim="{vote.z}"
				></FactorInfoButton>
			</td>
			{/if}
		</tr>
		{#if !$verticalLayout}
		<tr>
			<td>
				<FactorInfoButton
						axis='z'
						delta="{delta}"
						mode="page"
						on:toggle="toggleSurface('z')"
						poll="{poll}"
						voteDim="{vote.z}"
				></FactorInfoButton>
			</td>
		</tr>
		<tr>
			<td>
				<FactorInfoButton
						axis='y'
						delta="{delta}"
						mode="page"
						on:toggle="toggleSurface('y')"
						poll="{poll}"
						voteDim="{vote.y}"
				></FactorInfoButton>
			</td>
		</tr>
		<tr>
			<td
			>
				<FactorInfoButton
						axis='x'
						delta="{delta}"
						mode="page"
						on:toggle="toggleSurface('x')"
						poll="{poll}"
						voteDim="{vote.x}"
				></FactorInfoButton>
			</td>
		</tr>
		{/if}
	</table>
</article>
{/if}

<style>
	@media (min-width: 62em) {
		article {
			width: 54%;
		}

		.bottom-factor-table {
			width: calc(54% - 140px) !important;
		}
	}

	article {
		position: absolute;
	}

	.bottom-factor-table {
		bottom: 10px;
		color: black;
		margin-left: 70px;
		margin-right: 70px;
		position: fixed;
		width: calc(100% - 140px);
	}

	.leftViewport {
		right: 20%;
	}

	.offToRight {
		left: 33%;
	}

	.right-factor-table {
		height: calc(100% - 84px);
		margin-top: 20px;
		position: fixed;
		right: 75px;
		top: 44px;
	}

</style>

<script>
	import FactorInfoButton       from '../../../common/control/button/FactorInfoButton.html'
	import ChoiceRanking     from '../../../components/poll/ChoiceRanking.html'
	import {setupCubeView}        from '../../../database'
	import {shutDownCubeListener} from '../../../libs/cubeLogic'
	import {setResizeCllBck}      from '../../../resizer'
	import store                  from '../../../store'

	export default {
		components: {
			ChoiceRanking,
			FactorInfoButton
		},
		data() {
			return {
				delta: 0
			}
		},
		methods: {
			toggleSurface(
				factor
			) {
				this.get().mutationApi.toggleSurface(factor)
				this.set({delta: this.get().delta + 1})
			}
		},
		oncreate() {
			/*			setResizeCllBck((
							portalHeight,
							windowWidth,
							verticalLayout
						) => {
							let maxBarSize = portalHeight - 60

							if (verticalLayout) {
								maxBarSize = portalHeight / 2 - 20
							}

							this.set({maxBarSize})
						}, this.store)*/

			const pollId = this.store.get().routeParams.pollId

			setupCubeView(null, pollId, this).then()
			this.store.set({noOverflow: true})
		},
		ondestroy() {
			shutDownCubeListener(this.get().cubeListener, this)
			setResizeCllBck(null)
			this.store.set({noOverflow: false})
		},
		store: () => store
	}

</script>
