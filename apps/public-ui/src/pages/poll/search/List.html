{#if form}
<form>
    <Text
            field="{form.fields.search}"
    ></Text>
</form>
<table>
    {#each polls as poll}
    <ListItem
            poll="{poll}"
            on:select="goTo(poll.id)"
    ></ListItem>
    {/each}
</table>
<!--
<VirtualList items={factors} component={ListItem} />
-->
{/if}

<style>
    table {
        width: 100%;
    }
</style>
<script>
	import {DI}        from '@airport/di'
	import {POLL_DAO}  from '@votecube/public-db'
	// import VirtualList from '@sveltejs/svelte-virtual-list';
	import Text        from '../../../common/field/Text.html'
	import * as forms  from '../../../form/forms'
	import {loadForms} from '../../../libs/forms'
	import * as routes from '../../../routes'
	import store       from '../../../store'
	import ListItem    from './ListItem.html'

	export default {
		components: {
			ListItem,
			Text,
			// VirtualList
		},
		// data() {
		//   return {
		//     ListItem
		//   }
		// },
		methods: {
			goTo(
				pollId
			) {
				routes.navigateToPage(routes.POLL_INFO_CUBE, {
					pollId,
					mode: 'vote'
				})
			}
		},
		oncreate() {
			DI.get(POLL_DAO).then(
				pollDao =>
					Promise.all([
						loadForms(this),
						pollDao.findAll()
					]).then(([
						         {Field, FieldGroup},
						         polls
					         ]) => {
						const filter = new FieldGroup('List', {
							search: new Field([])
						}, [], this.store.get().text.UI.Poll)

						this.set({polls})
						forms.ensureForm(filter, this)
					})
			)
			this.store.set({
				pageTitle: 'Polls'
			})
		},
		ondestroy() {
			forms.clearForm(this)
		},
		store: () => store
	}
</script>
