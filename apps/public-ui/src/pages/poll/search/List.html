{#if form}
<form>
	<Text
			field="{form.fields.search}"
	></Text>
</form>
<table>
	{#each polls as poll}
	<ListItem
			poll="{poll}"
			on:select="goTo(poll.id)"
	></ListItem>
	{/each}
</table>
<!--
<VirtualList items={factors} component={ListItem} />
-->
{/if}

<style>
	table {
		width: 100%;
	}
</style>
<script>
	import {DI}        from '@airport/di'
	import {POLL_DAO}  from '@votecube/public-db'
	// import VirtualList from '@sveltejs/svelte-virtual-list';
	import Text        from '../../../common/field/Text.html'
	import * as forms  from '@votecube/public-logic/src/form/forms'
	import {loadForms} from '../../../libs/forms'
	import * as routes from '../../../routes'
	import store       from '../../../store'
	import ListItem    from './ListItem.html'

	export default {
		components: {
			ListItem,
			Text,
			// VirtualList
		},
		// data() {
		//   return {
		//     ListItem
		//   }
		// },
		methods: {
			goTo(
				pollId
			) {
				routes.navigateToPage(routes.POLL_INFO_CUBE, {
					pollId,
					mode: 'vote'
				})
			}
		},
		oncreate() {
			initPage(this)
		},
		ondestroy() {
			forms.clearForm(this)
		},
		store: () => store
	}

	async function initPage(page) {
		const pollDao = await DI.get(POLL_DAO)
		const [
			      {Field, FieldGroup},
			      polls
		      ]       = await Promise.all([
			loadForms(page),
			pollDao.getAll()
		])

		const filter = new FieldGroup('List', {
			search: new Field([])
		}, [], page.store.get().text.UI.Poll)

		page.set({polls})
		forms.ensureForm(filter, page)

		page.store.set({
			pageTitle: 'Polls'
		})
	}
</script>
