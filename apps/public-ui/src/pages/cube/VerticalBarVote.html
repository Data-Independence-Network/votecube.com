<div>
    <section>
        {pickedText}
    </section>
    <figure
                id="chart"
            style="
  transform: scale({zoomFactor}, {zoomFactor});
"
        >
        <table>
        <tr id="plus">
            <td
                class:selectedPlus="dimension === 'x'"
                on:click="pick('x')"
            >
            <div
            style="
        background-color: #{$currentValue.x.color};
        height: {xPlusHeight}px;
            "
            >
            </div>
            </td>
            <td
                class:selectedPlus="dimension === 'y'"
                on:click="pick('y')"
            >
            <div
            style="
        background-color: #{$currentValue.y.color};
        height: {yPlusHeight}px;
            "
            >
            </div>
            </td>
            <td
                class:selectedPlus="dimension === 'z'"
                on:click="pick('z')"
            >
            <div
            style="
        background-color: #{$currentValue.z.color};
        height: {zPlusHeight}px;
            "
            >
            </div>
            </td>
        </tr>
        <tr id="minus">
            <td
                class:selectedMinus="dimension === 'x'"
                on:click="pick('x')"
            >
            <div
            style="
        background-color: #{$currentValue.x.color};
        height: {xMinusHeight}px;
            "
            >
            </div>
            </td>
            <td
                class:selectedMinus="dimension === 'y'"
                on:click="pick('y')"
            >
            <div
            style="
        background-color: #{$currentValue.y.color};
        height: {yMinusHeight}px;
            "
            >
            </div>
            </td>
            <td
                class:selectedMinus="dimension === 'z'"
                on:click="pick('z')"
            >
            <div
            style="
        background-color: #{$currentValue.z.color};
        height: {zMinusHeight}px;
            "
            >
            </div>
            </td>
        </tr>
        </table>
    </figure>
    <nav>
        <ZoomPicker
            currentZoom="{currentZoom}"
            on:zoomChange="zoomChange(event)"
        />
        <table
                style="
                width: 100%;
                font-size: 3em;
                text-align: center;
            ">
            <tr>
                <td>
                    -
                </td>
                <td>
                    %
                </td>
                <td>
                    +
                </td>
            </tr>
            <LinearPositionPicker
                dimension="{$currentValue.x}"
                on:move="move('x', event)"
                on:moveToValue="moveToValue('x', event)"
            />
            <LinearPositionPicker
                dimension="{$currentValue.y}"
                on:move="move('y', event)"
                on:moveToValue="moveToValue('y', event)"
            />
            <LinearPositionPicker
                dimension="{$currentValue.z}"
                on:move="move('z', event)"
                on:moveToValue="moveToValue('z', event)"
            />
        </table>
    </nav>
</div>

<style>

    section {
        margin: 15px;
        font-size: 1.5em;
    }

    table {
        width: 100%;
    }

    #plus td {
        border-bottom: 1px solid black;
        vertical-align: bottom;
    }

    #minus td {
        vertical-align: top;
    }

    figure div {
        margin: 10px;
    }

    #plus div {
        margin-bottom: 0px;
    }

    #minus div {
        margin-top: 0px;
    }

    .selectedPlus {
        border: 1px dashed;
        border-bottom: 1px solid;
    }

    .selectedMinus {
        border: 1px dashed;
        border-top: 0px;
    }

    nav {
        margin-top: -10px;
    }

</style>

<script>
    import LinearPositionPicker from '../../common/control/LinearPositionPicker.html'
    import ZoomPicker from '../../common/control/ZoomPicker.html'
	import store from '../../store.js';

    export default {
        components: {
            LinearPositionPicker,
            ZoomPicker
        },
        computed: {
            pickedText: ({$currentValue, dimension, $text}) => {
                if(!dimension) {
                    return ''
                }
                let plusIndex = 0, minusIndex = 5
                if(dimension === 'y') {
                    plusIndex = 1
                    minusIndex = 3
                } else if (dimension === 'z') {
                    plusIndex = 2
                    minusIndex = 4
                }
                return $currentValue[dimension].dir === 1
                    ? $text[plusIndex]
                    : $text[minusIndex]
            },
            xPlusHeight: ({$currentValue}) => barHeight($currentValue.x, 1),
            xMinusHeight: ({$currentValue}) => barHeight($currentValue.x, -1),
            yPlusHeight: ({$currentValue}) => barHeight($currentValue.y, 1),
            yMinusHeight: ({$currentValue}) => barHeight($currentValue.y, -1),
            zPlusHeight: ({$currentValue}) => barHeight($currentValue.z, 1),
            zMinusHeight: ({$currentValue}) => barHeight($currentValue.z, -1)
        },
        data() {
            return {
                currentZoom: 1,
                dimension: null,
                zoomFactor: 0.9,
            }
        },
        methods: {
            zoomChange(event) {
                let currentZoom = parseInt(event.target.value)
                let zoomFactor
                switch (currentZoom) {
                    case 0:
                        zoomFactor = 0.8
                        break;
                    case 1:
                        zoomFactor = 0.9
                        break;
                    case 2:
                        zoomFactor = 1
                        break
                }
                this.set({currentZoom, zoomFactor})
                this.get().mutationApi.changeZoom(currentZoom)
            },
            move(
                dimension,
                direction
            ) {
                this.pick(dimension)
                this.get().mutationApi.move(dimension, direction)
            },
            moveToValue(
                dimension,
                value
            ) {
                this.pick(dimension)
                this.get().mutationApi.moveToValue(dimension, value)
            },
            pick(
                dimension
            ) {
                this.set({dimension})
            }
        },
        oncreate() {
            import('@votecube/cube-logic/lib/cube/eventListener').then((
                eventListener
            ) => {
            this.setCubeViewPort = (
                data,
                setMutationApi,
                callback
            ) => {
                setMutationApi(eventListener.setViewPort(
                    false, data, callback))
            }
            this.setCubeViewPort(
                this.store.get().currentValue,
                (
                    mutationApi
                ) => {
                    this.set({mutationApi})
                },
                (
                    currentValue
                ) => {
                    this.store.set({currentValue})
                },
            )
            })

        },
        ondestroy() {
            console.log('in VerticalBarVote ondestroy');
            this.setCubeViewPort(
                null,
                (
                    mutationApi
                ) => {
                    this.set({mutationApi})
                }
            )
        },
        store: () => store
    }

    function barHeight(
        dimensionPositionData,
        direction
    ) {
        return dimensionPositionData.dir === direction ? dimensionPositionData.value * 2 : 0
    }

</script>
