<figure
		class="{classes}"
>
	<table
			class="chart-contents"
	>
		<tr class="plus">
			<td>
				{#if xPlusHeight}
				<div
						class="{xPlus}"
						style="
        background-color: #{getColor(delta, poll, 'x')};
        height: {xPlusHeight}px;
            "
				>
				</div>
				{/if}
			</td>
			<td>
				{#if yPlusHeight}
				<div
						class="{yPlus}"
						style="
        background-color: #{getColor(delta, poll, 'y')};
        height: {yPlusHeight}px;
            "
				>
				</div>
				{/if}
			</td>
			<td>
				{#if zPlusHeight}
				<div
						class="{zPlus}"
						style="
        background-color: #{getColor(delta, poll, 'z')};
        height: {zPlusHeight}px;
            "
				>
				</div>
				{/if}
			</td>
		</tr>
		<tr class="minus">
			<td
			>
				{#if xMinusHeight}
				<div
						class="{xMinus}"
						style="
        background-color: #{getColor(delta, poll, 'x')};
        height: {xMinusHeight}px;
            "
				>
				</div>
				{/if}
			</td>
			<td
			>
				{#if yMinusHeight}
				<div
						class="{yMinus}"
						style="
        background-color: #{getColor(delta, poll, 'y')};
        height: {yMinusHeight}px;
            "
				>
				</div>
				{/if}
			</td>
			<td
			>
				{#if zMinusHeight}
				<div
						class="{zMinus}"
						style="
        background-color: #{getColor(delta, poll, 'z')};
        height: {zMinusHeight}px;
            "
				>
				</div>
				{/if}
			</td>
		</tr>
	</table>
</figure>
<style>
	/*
	@media (min-width: 62em) {
		.mainView {
			top: 15px;
			left: 5px;
		}
	}
	 */

	figure {
		height: 89px;
		width: 62px;
	}

	.mainView {
		top: 50px;
		right: 5px;
		position: fixed;
		/*z-index: 3; not relevant - not clickable for simplicity*/
	}

	.bottomDirection {
		border-bottom: 2px solid black;
	}

	.chart-contents {
		width: 100%;
	}

	.confirmFigure td {
		padding: 2px;
		vertical-align: middle;
	}

	.minus div {
		margin-top: 0px;
	}

	.minus td {
		vertical-align: top;
	}

	.pageFigure td,
	.pageTable td {
		padding: 5px;
		vertical-align: middle;
	}

	.plus {
		height: 45px;
	}

	.plus div {
		margin-bottom: 0px;
	}

	.plus td {
		vertical-align: bottom;
		border-bottom: 1px solid black;
	}

	.topDirection {
		border-top: 2px solid black;
	}

</style>

<script>
	import {getColor} from '../../helpers/cube'

	export default {
		computed: {
			xMinus: ({xMinusHeight}) => xMinusHeight ? 'bottomDirection' : '',
			xPlus: ({xPlusHeight}) => xPlusHeight ? 'topDirection' : '',
			yMinus: ({yMinusHeight}) => yMinusHeight ? 'bottomDirection' : '',
			yPlus: ({yPlusHeight}) => yPlusHeight ? 'topDirection' : '',
			zMinus: ({zMinusHeight}) => zMinusHeight ? 'bottomDirection' : '',
			zPlus: ({zPlusHeight}) => zPlusHeight ? 'topDirection' : ''
		},
		data: () => {
			return {
				maxBarSize: 44,
				xMinusHeight: 0,
				xPlusHeight: 0,
				yMinusHeight: 0,
				yPlusHeight: 0,
				zMinusHeight: 0,
				zPlusHeight: 0,
			}
		},
		helpers: {
			getColor
		},
		onstate({changed, current}) {
			if (!current.vote || !changed.delta) {
				return
			}

			const cubeView   = current.cubeView
			const maxBarSize = current.maxBarSize
			const vote       = current.vote

			this.set({
				xMinusHeight: barHeight(cubeView, vote.x, -1, maxBarSize),
				xPlusHeight: barHeight(cubeView, vote.x, 1, maxBarSize),
				yMinusHeight: barHeight(cubeView, vote.y, -1, maxBarSize),
				yPlusHeight: barHeight(cubeView, vote.y, 1, maxBarSize),
				zMinusHeight: barHeight(cubeView, vote.z, -1, maxBarSize),
				zPlusHeight: barHeight(cubeView, vote.z, 1, maxBarSize)
			})
		}
	}

	function barHeight(
		cubeView,
		voteFactor,
		position,
		maxBarSize
	) {
		if (!voteFactor) {
			return 0
		}
		if (cubeView) {
			return voteFactor.dir === position
				? voteFactor.value * maxBarSize / 100
				: 0
		} else {
			return voteFactor.factorDir === position
				? voteFactor.factorValue * maxBarSize / 100
				: 0
		}
	}

</script>