<table
		class="{classes}"
>
	{#each voteDims as voteDim, i}
	{#if showPosition(voteDim, delta)}
	<tr
			transition:fade
	>
		{#if !i || cubeView}
		<td
				class="ranking"
				on:click="onClick(cubeView)"
				rowspan="{cubeView ? 1 : 3}"
		>
			{#if !cubeView}
			<CubeMiniature
					poll="{poll}"
					vote="{vote}"
			></CubeMiniature>
			{/if}
			{#if cubeView}
			<figure
					style="background-color: #{getColor(delta, poll, voteDim.axis)};"
			>
<!--				{#if voteDim.dir === 1}-->
				<header></header>
<!--				{:else}-->
<!--				<footer></footer>-->
<!--				{/if}-->
				<CharacterButton
						character="{factorOutcome(voteDim)}"
						fontSize="20"
						fontX="12"
						fontY="19"
						size="24"
						strokeWidth="1"
						styles="left: {factorMiniLeft(voteDim)}px; position: absolute; top: 1px;"
				></CharacterButton>
			</figure>
			{/if}
		</td>
		{/if}
		<td
				class="a"
		>
			{#if haveWidth(voteDim, 1, delta)}
			<div
					class="bar {aClass(voteDim)}"
					style="
        background-color: #{getColor(delta, poll, voteDim.axis)};
        width: {getWidth(voteDim, delta)}%;
            "
			>
			</div>
			{/if}
		</td>
		<td
				class="b"
		>
			{#if haveWidth(voteDim, -1, delta)}
			<div
					class="bar {bClass(voteDim)}"
					style="
        background-color: #{getColor(delta, poll, voteDim.axis)};
        width: {getWidth(voteDim, delta)}%;
            "
			>
			</div>
			{/if}
		</td>
		<td
				class="percent"
		>
			<!--
			<CharacterButton
					character="{factorOutcome(voteDim)}"
					fontSize="20"
					fontX="12"
					fontY="19"
					size="24"
					strokeWidth="1"
					styles="left: 3px; position: absolute; top: 3px;"
			></CharacterButton>
			-->
			<span>{voteDim.value}%</span>
		</td>
	</tr>
	{/if}
	{/each}
	<tr>
		<td>
		</td>
		<td
		>
			<div
					class="spacer"
			></div>
			<div
					class="aAxisLabel"
			>
				A 100%
			</div>
			<div
					class="zeroAxisLabel"
			>
				0%
			</div>
		</td>
		<td>
			<div
					class="spacer"
			></div>
			<div
					class="bAxisLabel"
			>
				B 100%
			</div>
		</td>
		<td
				class="overall"
		>
			<summary>
		<span
				class="totalLabel"
		>Total:</span>
				<CharacterButton
						character="{outcome}"
						fontSize="22"
						fontX="13"
						fontY="21"
						size="26"
						strokeWidth="1"
						styles="left: 40px; position: absolute; top: 3px;"
				></CharacterButton>
				<span
						class="total"
				>
		{total}%
		</span>
			</summary>
		</td>
	</tr>
</table>
<style>
	/*
	@media (min-width: 62em) {
		.mainView {
			top: 15px;
			left: 5px;
		}
	}
	 */

	div.bar {
		height: 23px;
		margin-top: 3px;
	}

	div.spacer {
		height: 1px;
		width: 100%;
		border-right: 1px solid white;
	}

	figure {
		width: 45px;
		height: 25px;
		position: relative;
		border: 1px solid gray;
		border-radius: 3px;
	}

	footer {
		bottom: 0px;
	}

	header,
	footer {
		width: 100%;
		height: 5px;
		position: absolute;
		background-color: black;
	}

	header {
		top: 0px
	}

	.overall .total {
		font-size: 1.7em;
	}

	span {
		display: inline-block;
		color: black;
		font-size: 1.4em;
		font-weight: bold;
		height: 29px;
		left: 19px;
		line-height: 30px;
		position: absolute;
		top: 0px;
		vertical-align: center;
	}

	span.total {
		left: 70px;
	}

	span.totalLabel {
		font-weight: normal;
		left: -20px;
	}

	summary {
		border-top: 1px solid gray;
		bottom: -40px;
		color: black;
		left: -50px;
		padding-top: 10px;
		position: absolute;
		width: 150px;
	}

	/*
	https://stackoverflow.com/questions/15873302/using-calc-with-tables
	 */
	table {
		/* required for table-layout to be used
			(since this is the default value it is normally not necessary;
		just included for completeness) */
		/*display: table;*/
		position: relative;
		table-layout: fixed; /* this keeps your columns with at the defined width */
		width: 100%; /* a width must be specified */
	}

	td {
		/*padding-top: 1px;*/
		position: relative;
	}

	td.ranking {
		width: 80px;
	}

	td.a {
		border-left: 1px solid gray;
	}

	td.b {
		border-right: 1px solid gray;
	}

	td.percent {
		width: 80px;
	}

	.a {
		border-right: 1px solid black;
	}

	.aAxisLabel {
		bottom: -20px;
		left: -20px;
		position: absolute;
	}

	.bAxisLabel {
		bottom: -20px;
		position: absolute;
		right: -25px;
	}

	.zeroAxisLabel {
		bottom: -20px;
		position: absolute;
		right: -14px;
	}

	.leftDirection {
		border-left: 2px solid black;
	}

	.b,
	.a {
		width: calc(50% - 80px);
	}

	.a div {
		float: right
	}

	.rightDirection {
		border-right: 2px solid black;
	}

	/*
		.minus td {
			vertical-align: top;
		}*/

	/*
	.pageFigure td,
	.pageTable td {
		padding: 5px;
		vertical-align: middle;
	}
	*/

	/*	.plus div {
			margin-bottom: 0px;
		}*/

	.a td {
		/*vertical-align: bottom;*/
		border-right: 1px solid black;
	}

</style>

<script>
	import {
		fade,
		fly
	}                      from 'svelte-transitions'
	import CharacterButton from '../../common/control/button/CharacterButton.html'
	import {getColor}      from '../../helpers/cube'
	import CubeMiniature   from '../poll/CubeMiniature.html'
	import DetailedCube    from '../poll/DetailedCube.html'

	export default {
		components: {
			CharacterButton,
			CubeMiniature,
			DetailedCube
		},
		computed: {
			signedTotal: ({voteDims, delta}) => voteDims.reduce((
				total,
				voteDim
			) => total + voteDim.value * voteDim.dir, 0),
			outcome: ({signedTotal}) => {
				if (signedTotal === 0) {
					return ' '
				}
				return signedTotal > 0 ? 'A' : 'B'
			},
			total:
				({signedTotal}) => Math.abs(signedTotal),
			// outcomeFontY: ({outcome}) => outcome === 'B' ? 21 : 21
		},
		helpers: {
			aClass:
				voteDim => voteDim.dir === 1 ? 'leftDirection' : '',
			bClass:
				voteDim => voteDim.dir === -1 ? 'rightDirection' : '',
			factorOutcome:
				voteDim => voteDim.dir > 0 ? 'A' : 'B',
			factorMiniLeft:
				voteDim => voteDim.dir > 0 ? 0 : 19,
			getColor,
			getWidth:
				voteDim => voteDim.value,
			haveWidth: (
				voteDim,
				dir
			) => voteDim.dir === dir,
			showPosition:
				voteDim => voteDim.value,
		},
		methods: {
			onClick(cubeView) {
				this.fire('toggleView')
			}
		},
		transitions: {
			fade,
			fly
		}
	}

</script>