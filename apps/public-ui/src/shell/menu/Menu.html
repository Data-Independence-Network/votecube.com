<nav
		class:active="active"
		id="menu"
>
	<section
			class="pure-menu"
	>
		<ul class="pure-menu-list">
			{#each menuItems as menuItem, index}
			<MenuItem
					index="{index}"
					menuItem="{menuItem}"
					on:select="selectMenu(event)"
					selectedIndex="{selectedMenuIndex}"
			></MenuItem>
			{/each}
			<li
					class="pure-menu-item {selectedClass}"
					on:click="aboutUs()"
			>
				<a
						class="pure-menu-link"
				>
					About Us
				</a>
			</li>
			<li
					class="pure-menu-item {selectedClass}"
					on:click="releasePlan()"
			>
				<a
						class="pure-menu-link"
				>
					Release Plan
				</a>
			</li>
			<li
					class="pure-menu-item {selectedClass}"
					on:click="feedback()"
			>
				<a
						class="pure-menu-link"
				>
					Feedback
				</a>
			</li>
			{#if $user}
			<li
					class="pure-menu-item {selectedClass}"
					on:click="signOut()"
			>
				<a
						class="pure-menu-link"
				>
					Sign Out
				</a>
			</li>
			{:else}
			<li
					class="pure-menu-item {selectedClass}"
					on:click="signIn()"
			>
				<a
						class="pure-menu-link"
				>
					Sign In
				</a>
			</li>
			{/if}
		</ul>
	</section>
	<div
			id="sizer"
	></div>

</nav>
<style>
	section {
		margin-top: 44px;
	}
</style>
<script>
	import {DI}        from '@airport/di'
	import {AUTH}      from '@votecube/public-logic'
	import {ROUTES}    from '@votecube/public-logic/src'
	import * as routes from '../../routes'
	import store       from '../../store.js'
	import MenuItem    from './MenuItem.html'

	export default {
		components: {
			MenuItem
		},
		data() {
			return {
				menuItems: [{
					index: 0,
					key: routes.POLL_LIST,
					name: 'Polls'
				}, {
					auth: true,
					index: 1,
					key: routes.POLL_FORM,
					params: routes.DEFAULT_ROUTE_PARAMS,
					name: 'Create Poll',
				}
				],
				selectedMenuIndex: 0
			}
		},
		methods: {
			aboutUs() {
				toPage('ABOUT', this).then()
			},
			feedback() {
				toPage('FEEDBACK', this).then()
			},
			releasePlan() {
				toPage('RELEASE_PLAN', this).then()
			},
			// clickMenuLink(event) {
			// if (DOM_API.e(menuElementIdSelector)
			//   .className
			//   .indexOf('active') !== -1) {
			//   this.toggleAll(event)
			// }
			// },
			signIn() {
				this.store.set({signIn: true})
				this.store.toggleMainMenu()
			},
			signOut() {
				doSignOut(this).then()
			},
			selectMenu(menuItem) {
				this.set({selectedMenuIndex: menuItem.index})
				this.fire('selected', menuItem)
			}
		},
		oncreate() {
			initComp(this)
		},
		store: () => store
	}

	async function initComp(
		comp
	) {
		comp.store.set({emInPx: getEmInPx()})
		const container = DI.ui('Menu')

		comp.set({container})
	}

	async function toPage(
		pageKey,
		comp
	) {
		const {container} = comp.get()

		const routes = await container.get(ROUTES)

		routes.navigateToPage(routes[pageKey])
		this.store.toggleMainMenu()
	}

	async function doSignOut(
		comp
	) {
		const {container} = comp.get()
		const auth = await container.get(AUTH)
		await auth.signOut()
		this.store.toggleMainMenu()
	}

	function getEmInPx() {
		var div          = document.getElementById('sizer')
		div.style.height = '1em'
		return div.offsetHeight
	}
</script>