<!--
<svg
        width="50" height="50" xmlns="http://www.w3.org/2000/svg"
        on:click="test()"
>
    &lt;!&ndash; Created with SVG-edit - https://github.com/SVG-Edit/svgedit&ndash;&gt;
    <g class="layer">
        <title>Layer 1</title>
        <circle cx="25.04944" cy="24.95393" fill="#FF0000" id="svg_4"
                r="24.08726"
                stroke="#FF0000" stroke-width="3"
                transform="rotate(179.928 25.0494 24.9539)"/>
        <text fill="#FFFFFF" font-family="monospace" font-size="24"
              id="svg_5"
              stroke="#FFFFFF" stroke-width="0" text-anchor="middle"
              transform="rotate(0.321025 27.4393 23.2802) matrix(1.44163 0 0 1.64003 16.5919 -4.80528)"
              x="7.53445" xml:space="preserve" y="25.169">&gt;</text>
    </g>
</svg>
-->
<svelte:window on:resize="handleResize(event)"/>
<article
        class="{activeClass}"
        id="layout"
>
    <!-- Menu toggle -->
    <TopBar
        mainMenuActive={isMenuActive}
        on:setViewType="setViewType(event)"
        ></TopBar>
    <nav
            class="menu-link {activeClass}"
            id="menuLink"
            on:click="toggleMenu()"
    >
        <!--Hamburger icon -->
        <span></span>
    </nav>
    <Menu
        active="{$showMainMenu}"
        on:selected="selectMenu(event)"
    ></Menu>
    <section
            id="main"
            on:click="clickMain()"
    >
        <svelte:component this="{PageComp}"/>

    </section>
</article>

<style>
    #main {
        height: 100%;
    }
</style>

<script>
import page from 'page'
import {PAGE_CONF} from './pageConfig.js'
import {scheduleToResize, startResizeInterval} from './resizer.js'
import NamePlaceTimeSelector from './pages/cube/create/NamePlaceTimeSelector.html'
import PlaceSelector from './pages/cube/create/PlaceSelector.html'
import CubeVote from './pages/cube/vote/CubeVote.html'
import VerticalBarVote from './pages/cube/vote/VerticalBarVote.html'
import Menu from './shell/menu/Menu.html'
import TopBar from './shell/top/TopBar.html'
import store from './store.js';

export default {
    components: {
        Menu,
        TopBar
    },
    computed: {
        activeClass: ({$showMainMenu}) => $showMainMenu ? 'active' : ''
    },
    data() {
        return {
            PageComp: null
        }
    },
    methods: {
        clickMain() {
            // if (DOM_API.e(menuElementIdSelector)
            //   .className
            //   .indexOf('active') !== -1) {
            if (this.store.get().showMainMenu) {
                this.toggleMenu()
            }
        },
        handleResize(
            event
        ) {
            scheduleToResize(this.store)
        },
        selectMenu(
            menuItem
        ) {
            switch(menuItem.key) {
                case 'createPoll': {
                    navigateToPage(this, menuItem.key)
                    break
                }
            }
            this.store.toggleMainMenu()
        },
        toggleMenu() {
            this.store.toggleMainMenu()
        },
        toggleSurface(
            dimension
        ) {
            this.get().mutationApi.toggleSurface(dimension)
        },
        setPageComp(
            PageComp
        ) {
            this.set({PageComp})
        },
        setViewType(
            viewType
        ) {
            navigateToPage(this, viewType)
        }
    },
    oncreate() {
        page(
            '/', () => {
            setPageComp(PAGE_CONF.cube, CubeVote, this)
        })
        page(
            '/poll/vote/cube', () => {
            setPageComp(PAGE_CONF.cube, CubeVote, this)
        })
        page(
            '/poll/vote/chart', () => {
            setPageComp(PAGE_CONF.chart, VerticalBarVote, this)
        })
        page(
            '/poll/create/1', () => {
            setPageComp(PAGE_CONF.createPoll1, NamePlaceTimeSelector, this)
        })
        page(
            '/place/select', () => {
            setPageComp(PAGE_CONF.selectPlace, PlaceSelector, this)
        })
        page({
            hashbang: true
        })

        startResizeInterval(this.store)
    },
    store: () => store
}

function navigateToPage(
    appComp,
    pageKey
) {
    let currentPage
    switch (pageKey) {
        case 'createPoll': {
            currentPage = PAGE_CONF.createPoll1
            page('/poll/create/1')
            break
        }
        case 'chart': {
            currentPage = PAGE_CONF.chart
            page('/poll/vote/chart')
            break
        }
        case 'cube': {
            currentPage = PAGE_CONF.cube
            page('/poll/vote/cube')
            break
        }
    }
    appComp.store.set({currentPage})
}

function setPageComp(
    currentPage,
    PageComp,
    appComp
) {
    appComp.store.set({currentPage})
    appComp.set({PageComp})
}

</script>