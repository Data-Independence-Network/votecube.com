{#if $forms}
<label for="name">{label}</label>
<input
    bind:value="field.value"
    class:invalid="touched && errors.length"
    class:requiredInvalid="field.validatorMap.required && errors.length"
    class:requiredValid="field.validatorMap.required && !errors.length"
    id="{id}"
    use:maxlength="field.maxLength"
    on:blur="onBlur(event)"
    on:input="onInput(event)"
    placeholder="{placeholder}"
    type="text"
>
    {#if touched}
        {#each errors as error}
    <span class="pure-form-message">{error.message}</span>
        {/each}
    {/if}
    {#if !touched || !errors.length}
    <span class="pure-form-message">&nbsp;</span>
    {/if}
{/if}

<style>
    input {
        width: 100%;
    }
    label {
        height: 18px;
    }
    span {
        color: red;
    }
</style>

<script>
// 'field' is an input property
// import {Field} from '@votecube/forms'
import store from '../../store.js'

export default {
    actions: {
        maxlength(node, maxLength) {
            if(maxLength) {
                node.maxLength = maxLength;
            }
        }
    },
    computed: {
        errors: ({delta, field}) => field.errors,
        label: ({delta, field, $forms}) => {
            const LabelRule = $forms.CONSTS.rules.label;
            switch(field.rules.label) {
                case LabelRule.BOTH:
                    return field.value ? field.text.label : ''
                case LabelRule.IN:
                case LabelRule.NONE:
                    return ''
                case LabelRule.OVER:
                    return field.text.label
            }
        },
        placeholder: ({delta, field, $forms}) => {
            const LabelRule = $forms.CONSTS.rules.label;
            switch(field.rules.label) {
                case LabelRule.BOTH:
                case LabelRule.IN:
                    return field.text.label
                case LabelRule.NONE:
                case LabelRule.OVER:
                    return ''
            }
        },
        touched: ({delta, field}) => field.touched
    },
    immutable: true,
    methods: {
        onBlur(event) {
            this.get().field.onBlur()
        },
        onInput(event) {
            this.get().field.onInput()
        }
    },
    oncreate() {
        this.get().field.page = this
    },
    store: () => store
}
</script>