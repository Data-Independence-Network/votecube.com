{#if $forms && colors}
<div>
    <table>
    <tr>
        <td>
            <select
                on:input="selectColor(this.selectedIndex)"
                ref:select
            >
    {#each colors as color, index}
                <option
                    value="{index}"
                >
                    {color.name}
                </option>
    {/each}
            </select>
        </td>
        <td>
            <figure
                style="background-color: rgb({color.red}, {color.green}, {color.blue})"
            ></figure>
        </td>
    </tr>
    </table>
</div>
<section>
<input
    class="redSlider"
    max="255"
    min="0"
    on:input="syncInput()"
    ref:redSlider
    type="range"
    value="{color.red}"
>
</section>
<section>
<input
    class="greenSlider"
    max="255"
    min="0"
    on:input="syncInput()"
    ref:greenSlider
    type="range"
    value="{color.green}"
>
</section>
<section>
<input
    class="blueSlider"
    max="255"
    min="0"
    on:input="syncInput()"
    ref:blueSlider
    type="range"
    value="{color.blue}"
>
</section>
{/if}

<style>

    input {
        -webkit-appearance: none;  /* Override default CSS styles */
        appearance: none;
        background: #aaa;
        height: 5px; /* Specified height */
        outline: none; /* Remove outline */
        width: 100%; /* Full-width */
    }

    input::-webkit-slider-thumb {
        -webkit-appearance: none; /* Override default look */
        appearance: none;
        border: 3px groove gray;
        border-radius: 3px;
        cursor: pointer; /* Cursor on hover */
        height: 45px; /* Slider handle height */
        width: 45px; /* Set a specific slider handle width */
    }

    input::-moz-range-thumb {
        cursor: pointer; /* Cursor on hover */
        border: 3px groove gray;
        border-radius: 3px;
        height: 45px; /* Slider handle height */
        width: 45px; /* Set a specific slider handle width */
    }

    section {
        margin: 35px 0;
    }

    select {
        display: block;
        margin: auto;
    }

    figure {
        border: 4px groove gray;
        border-radius: 6px;
        height: 90px;
        margin: auto;
        width: 90px;
    }

    table {
        width: 100%;
    }

    .redSlider::-webkit-slider-thumb {
        background: #f22;
    }

    .redSlider::-moz-range-thumb {
        background: #f22;
    }

    .greenSlider::-webkit-slider-thumb {
        background: #2f2;
    }

    .greenSlider::-moz-range-thumb {
        background: #2f2;
    }

    .blueSlider::-webkit-slider-thumb {
        background: #22f;
    }

    .blueSlider::-moz-range-thumb {
        background: #22f;
    }

</style>

<script>
import store from '../../store.js'
import {getColorKey, getColors} from '../../libs/colors'

export default {
    methods: {
        selectColor(
            colorIndex
        ) {
            const {colors} = this.get()
            const color = copyColor(colors[colorIndex])
            this.get().field.value = color

            this.set({color})
        },
        syncInput() {
            const {color, colorMap} = this.get()
            color.red = this.refs.redSlider.value
            color.green = this.refs.greenSlider.value
            color.blue = this.refs.blueSlider.value
            const colorKey = getColorKey(color)
            const matchedColor = colorMap[colorKey]

            if(matchedColor) {
                this.refs.select.selectedIndex = matchedColor.index
            }

            this.set({color})
        }
    },
    oncreate() {
        getColors().then(({
            colors,
            colorMap
        }) => {
            let color = copyColor(colors[132])
            this.set({colors, colorMap, color})
            setTimeout(() => {
                this.refs.select.selectedIndex = 132
            })

            this.get().field.setAsField(this)
            this.get().field.value = color
            this.get().field.validate()
        })
    },
    ondestroy() {
        this.get().field.removeComponent(this)
    },
    store: () => store
}

function copyColor(
    color
) {
    return {
        name: color.name,
        ...color
    }
}

</script>