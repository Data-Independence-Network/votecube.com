{#if $forms}
<div
		class="textArea"
>
	{#if floatLabel}
	<label
			class="field-label"
			use:for="{id}"
	>
		{label}
	</label>
	{/if}
	{#if matches}
	<a>{matches.length} matches</a>
	{/if}
	<section
			class="field fieldBox"
			class:invalid="touched && errors.length"
			class:modified="modified"
			class:requiredInvalid="requiredInvalid"
			class:requiredValid="requiredValid"
	>
		<div
				class="text"
				class:mid="mid"
				class:mini="mini"
		>
<!--		            use:id="{id}"-->
            <textarea
		            class:mid="mid"
		            class:mini="{mini}"
		            on:blur="onBlur(event)"
		            on:input="onInput(event)"
		            placeholder="{placeholder}"
		            type="text"
		            use:maxlength="field.rules.maxLength"
		            rows="5"
		            value="{value}"
            />
		</div>
		<div
				class="icons"
				class:mid="mid"
				class:mini="mini"
		>
			<div
					class="multiRowIconsCenter"
			>
				{#if trackOriginal}
				<UndoIcon
						on:select="revert()"
						multiLine="y"
				></UndoIcon>
				{:else}
				<ClearIcon
						on:select="clear()"
						multiLine="y"
				></ClearIcon>
				{/if}
				<InfoIcon
						on:select="help()"
						multiLine="y"
				></InfoIcon>
			</div>
		</div>
	</section>
	<table>
		<tr>
			<td>
				{#if touched}
				{#each errors as error}
				<span class="pure-form-message error">{error.message}</span>
				{/each}
				{/if}
			</td>
			<td
					class:mid="mid"
					class:mini="mini"
			>
				{charCount}
			</td>
		</tr>
	</table>
</div>
{/if}

<style>

	a {
		display: inline-block;
		position: absolute;
		right: 10px;
		top: 0px;
	}

	section {
		position: relative;
	}

	table {
		width: 100%;
	}

	td:first-child {
		width: calc(100% - 80px);
	}

	td:first-child.mid,
	td:first-child.mini {
		width: calc(100% - 50px);
	}

	td:last-child {
		padding: 5px;
		width: 80px;
	}

	td:last-child.mid,
	td:last-child.mini {
		padding: 3px;
		width: 50px;
	}

	textarea {
		border: 0;
		box-shadow: none;
		display: inline-block;
		margin: 0;
		margin-top: 8px;
		padding-left: 5px;
		mini-align: text-bottom;
		width: 100%;
	}

	textarea.mini {
		height: 85px;
	}

	textarea.mid {
		height: 162px;
	}

	.fieldBox {
		background-color: white;
		min-height: 2.25em;
		padding-bottom: 5px;
		position: relative;
		width: 100%;
	}

	.icons {
		display: inline-block;
		height: 100%;
		position: absolute;
		right: 1px;
		top: 1px;
	}

	.icons.mid,
	.icons.mini {
		width: 30px;
	}

	.text {
		display: inline-block;
		width: calc(100% - 70px);
	}

	.text.mid,
	.text.mini {
		width: calc(100% - 30px);
	}

	.textArea {
		position: relative;
		text-align: left;
	}

</style>

<script>
	import store     from '../../store.js'
	import ClearIcon from '../icon/ClearIcon.html'
	import InfoIcon  from '../icon/InfoIcon.html'
	import UndoIcon  from '../icon/UndoIcon.html'

	export default {
		actions: {
			for(
				node,
				id
			) {
				if (id) {
					node.id = id
				}
			},
/*			id(
				node,
				id
			) {
				if (id) {
					node.id = id
				}
			},*/
			maxlength(
				node,
				maxLength
			) {
				if (maxLength) {
					node.maxLength = maxLength
				}
			}
		},
		components: {
			ClearIcon,
			InfoIcon,
			UndoIcon
		},
		computed: {
			charCount: ({delta, field, mid, mini}) => {
				const separator = mid || mini ? '/' : ' / '
				return field.rules.maxLength
					? `${field.value ? field.value.length : 0}${separator}${field.rules.maxLength}`
					: ''
			},
			errors: ({delta, field}) => field.errors,
			label: ({delta, field}) => field.label,
			matches: ({delta, field}) => field.matches,
			modified: ({delta, errors, field}) =>
				!errors.length && field.rules.trackOriginal && !field.theIsOriginal,
			placeholder: ({delta, field}) => field.placeholder,
			requiredInvalid: ({delta, errors, field}) =>
				field.validatorMap.required && errors.length,
			requiredValid: ({delta, errors, field, modified}) =>
				!modified && field.validatorMap.required && !errors.length,
			touched: ({delta, field}) => field.touched,
			trackOriginal: ({delta, field}) => field.rules.trackOriginal,
			value: ({delta, field}) => field.value
		},
		data: () => ({
			floatLabel: true
		}),
		immutable: true,
		methods: {
			clear() {
				this.get().field.clear()
			},
			help() {
				const text = this.get().field.text
				this.store.setTextToast(text.info, text.infoSeconds)
			},
			onBlur(event) {
				this.get().field.onBlur()
			},
			onInput(event) {
				const {field} = this.get()
				field.value   = event.target.value
				field.onInput()
			},
			revert() {
				this.get().field.revert()
			}
		},
		oncreate() {
			this.get().field.setAsField(this)
		},
		ondestroy() {
			this.get().field.removeComponent(this)
		},
		store: () => store
	}
</script>