<aside
		transition:fly='{y:200, duration: 500}'
>
	<nav
			on:click="fire('close')"
	>
		x
	</nav>
	<div></div>
	<section>
		<table>
			<!-- TODO: add support for voting value -->
			<LinearPositionPicker
					axis="x"
					moveDelta="{moveDelta}"
					on:move="move('x', event.position, event.percentChange)"
					on:moveToValue="moveToValue('x', event)"
					on:update="update()"
					poll="{poll}"
					value="{vote.x}"
					ref:xPicker
			/>
			<LinearPositionPicker
					axis="y"
					moveDelta="{moveDelta}"
					on:move="move('y', event.position, event.percentChange)"
					on:moveToValue="moveToValue('y', event)"
					on:update="update()"
					poll="{poll}"
					value="{vote.y}"
					ref:yPicker
			/>
			<LinearPositionPicker
					axis="z"
					moveDelta="{moveDelta}"
					on:move="move('z', event.position, event.percentChange)"
					on:moveToValue="moveToValue('z', event)"
					on:update="update()"
					poll="{poll}"
					value="{vote.z}"
					ref:zPicker
			/>
		</table>
	</section>
</aside>

<style>
	@media (min-width: 62em) {
		aside {
			width: 54%;
		}
	}

	aside {
		background: transparent;
		bottom: 0px;
		color: black;
		margin: 0px;
		padding: 3px;
		position: fixed;
	}

	div {
		border-top: 2px dashed black;
		margin-left: 50px;
		position: relative;
		top: 0px;
		width: calc(100% - 53px);
	}

	nav {
		background: hsla(0, 100%, 100%, 0.8);
		border: 2px dashed black;
		border-bottom: 0px;
		border-top-left-radius: 3px;
		border-top-right-radius: 3px;
		color: black;
		font-size: 2em;
		height: 45px;
		text-align: center;
		vertical-align: middle;
		width: 50px;
	}

	section {
		background: hsla(0, 100%, 100%, 0.8);
		border: 2px dashed black;
		border-top: 0px;
		font-size: 3em;
		text-align: center;
		width: 100%;
	}
</style>


<script>
	import store                from '../../store.js'
	import {fly}             from 'svelte-transitions'
	import LinearPositionPicker from './LinearPositionPicker.html'

	export default {
		components: {
			LinearPositionPicker
		},
		data: () => {
			return {
				internalDelta: 0
			}
		},
		computed: {
			moveDelta: ({delta, internalDelta}) => {
				return delta + internalDelta
			}
		},
		methods: {
			move(
				factor,
				position,
				percentChange
			) {
				this.fire('move', {
					factor,
					position,
					percentChange
				})
				this.set({internalDelta: this.get().internalDelta + 1})
			},
			moveToValue(
				factor,
				value
			) {
				this.fire('moveToValue', {
					factor,
					value
				})
				refresh(this)
			},
			update() {
				refresh(this)
			}
		},
		store: () => store,
		transitions: {fly}
	}

	function refresh(
		page
	) {
		page.refs.xPicker.fire('refresh')
		page.refs.yPicker.fire('refresh')
		page.refs.zPicker.fire('refresh')
	}

</script>