<tr>
   <td
       on:touchstart="mouseDown(-1)"
       on:touchend="mouseUp(-1)"
   >
      <svg
          height="50"
          width="50"
      >
      <!--
          on:click="fire('move', -1, 1)"
      -->
         <g class="layer">
            <circle 
                cx="25"
                cy="25"
                fill="#{leftFillColor}"
                r="{leftCircleRadius}"
                stroke="#{leftHighlightColor}"
                stroke-width="{leftStrokeWidth}"
            />
            <text 
                fill="#{leftHighlightColor}"
                font-family="monospace"
                font-size="24"
                stroke="#FFFFFF"
                stroke-width="0"
                text-anchor="middle"
                transform="rotate(0 23.5 23.2) matrix(1.44 0 0 1.64 16.4 -1.8)"
                x="4.9"
                xml:space="preserve"
                y="23.3"
            >
               &lt;
            </text>
         </g>
      </svg>
   </td>
   <td>
      <input
          maxlength="3"
          on:input="fire('moveToValue', this.value)"
          style="
            border-bottom: {valueBottomBorder};
          "
          value="{dimension.value}"
      >
   </td>
   <td
          on:touchstart="mouseDown(1)"
          on:touchend="mouseUp(1)"
   >
      <svg
          width="50"
          height="50"
      >
      <!--
          on:click="fire('move', 1)"
      -->
         <g class="layer">
            <circle 
                cx="25"
                cy="25"
                fill="#{rightFillColor}"
                r="{rightCircleRadius}"
                stroke="#{rightHighlightColor}"
                stroke-width="{rightStrokeWidth}"
            />
            <text
                fill="#{rightHighlightColor}"
                font-family="monospace"
                font-size="24"
                stroke="#FFFFFF"
                stroke-width="0"
                text-anchor="middle"
                transform="rotate(0.32 27.4 23.28) matrix(1.44 0 0 1.64 16.6 -4.8)"
                x="7.5"
                xml:space="preserve"
                y="25"
            >
               &gt;
            </text>
         </g>
      </svg>
   </td>
</tr>

<style>
    input {
        background: transparent;
        border: 0px;
        width: 100%;
        text-align: center;
    }
    svg {
        display: block;
        margin: auto;
    }
    td {
        font-size: 0.8em;
        height: 70px;
        width: 33%;
    }
</style>

<script>
export default {
    computed: {
        valueBottomBorder: ({dimension}) => getInputBorder(dimension),
        leftCircleRadius: ({dimension}) => getRadius(-1, dimension),
        rightCircleRadius: ({dimension}) => getRadius(1, dimension),
        leftStrokeWidth: ({dimension}) => getStrokeWidth(-1, dimension),
        rightStrokeWidth: ({dimension}) => getStrokeWidth(1, dimension),
        leftHighlightColor: ({dimension}) => getColor(1, dimension),
        rightHighlightColor: ({dimension}) => getColor(-1, dimension),
        leftFillColor: ({dimension}) => getColor(-1, dimension),
        rightFillColor: ({dimension}) => getColor(1, dimension),
    },
    methods: {
        mouseDown(
               direction
        ) {
            const percentChange = 1
            this.set({lastNumIncs: 5, percentChange})

            this.fire('move', {
                direction,
                percentChange
            })

            setIntrvl(this, 360, direction, 4, 3, 1)
        },
        mouseUp(
            direction
        ) {
            clearIntrvl(this)
        },
    }
}

    function checkInterval(
        page
    ) {
        let numIncs = page.get().numIncs - 1

        let percentChange = page.get().percentChange
        let direction = page.get().direction

        page.fire('move', {
            direction,
            percentChange
        });

        if (!numIncs) {
            clearIntrvl(page)
            let numReIncs = page.get().numReIncs - 1
            if(!numReIncs) {
                return
            }
            let interval = page.get().interval / 2
            let numIncs = page.get().lastNumIncs * 2
            percentChange = percentChange * 3

            page.set({lastNumIncs: numIncs})
            setIntrvl(page, interval, direction, numIncs, numReIncs, percentChange)
        } else {
            page.set({numIncs})
        }
    }

    function setIntrvl(
        page,
        interval,
        direction,
        numIncs,
        numReIncs,
        percentChange,
    ) {
        // console.log(`interval: ${interval}, direction: ${direction}, numIncs: ${numIncs}, numReIncs: ${numReIncs}, percentChange: ${percentChange}`)

        const incrementInterval = setInterval(() => {
            checkInterval(page)
        }, interval)

        page.set({direction, incrementInterval, interval, numIncs, numReIncs, percentChange})
    }

    function clearIntrvl(
        page
    ) {
        let incrementInterval = page.get().incrementInterval

        if(incrementInterval) {
            clearInterval(incrementInterval);
        }
    }

    function getInputBorder(
        dimension
    ) {
        return dimension.valid
        ? '0px'
        : '3px solid red'
    }

    function getRadius(
        dir,
        dimension
    ) {
        return dir === dimension.dir
        ? 24
        : 23
    }

    function getStrokeWidth(
        dir,
        dimension
    ) {
        return dir === dimension.dir
        ? 0
        : 3
    }

    function getColor(
        dir,
        dimension
    ) {
        return dir === dimension.dir
        ? dimension.color
        : 'FFFFFF'
    }
</script>
