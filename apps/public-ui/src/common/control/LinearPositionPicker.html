<tr>
    <td
        on:touchstart="mouseDown(-1)"
        on:touchend="mouseUp(-1)"
    >
        <LeftButton
            circleRadius="{leftCircleRadius}"
            fillColor="{leftFillColor}"
            highlightColor="{leftHighlightColor}"
            strokeWidth="{leftStrokeWidth}"
        ></LeftButton>
   </td>
   <td>
      <input
          maxlength="3"
          on:input="fire('moveToValue', this.value)"
          style="
            border-bottom: {valueBottomBorder};
          "
          value="{dimension.value}"
      >
   </td>
   <td
          on:touchstart="mouseDown(1)"
          on:touchend="mouseUp(1)"
   >
        <RightButton
            circleRadius="{rightCircleRadius}"
            fillColor="{rightFillColor}"
            highlightColor="{rightHighlightColor}"
            strokeWidth="{rightStrokeWidth}"
        ></RightButton>
   </td>
</tr>

<style>
    input {
        background: transparent;
        border: 0px;
        width: 100%;
        text-align: center;
    }
    svg {
        display: block;
        margin: auto;
    }
    td {
        font-size: 0.8em;
        height: 70px;
        width: 33%;
    }
</style>

<script>
import LeftButton from './button/LeftButton.html'
import RightButton from './button/RightButton.html'

export default {
    components: {
        LeftButton,
        RightButton
    },
    computed: {
        valueBottomBorder: ({dimension}) => getInputBorder(dimension),
        leftCircleRadius: ({dimension}) => getRadius(-1, dimension),
        rightCircleRadius: ({dimension}) => getRadius(1, dimension),
        leftStrokeWidth: ({dimension}) => getStrokeWidth(-1, dimension),
        rightStrokeWidth: ({dimension}) => getStrokeWidth(1, dimension),
        leftHighlightColor: ({dimension}) => getColor(1, dimension),
        rightHighlightColor: ({dimension}) => getColor(-1, dimension),
        leftFillColor: ({dimension}) => getColor(-1, dimension),
        rightFillColor: ({dimension}) => getColor(1, dimension),
    },
    methods: {
        mouseDown(
               direction
        ) {
            const percentChange = 1
            this.set({lastNumIncs: 5, percentChange})

            this.fire('move', {
                direction,
                percentChange
            })

            setIntrvl(this, 360, direction, 4, 3, 1)
        },
        mouseUp(
            direction
        ) {
            clearIntrvl(this)
        },
    }
}

    function checkInterval(
        page
    ) {
        let numIncs = page.get().numIncs - 1

        let percentChange = page.get().percentChange
        let direction = page.get().direction

        page.fire('move', {
            direction,
            percentChange
        });

        if (!numIncs) {
            clearIntrvl(page)
            let numReIncs = page.get().numReIncs - 1
            if(!numReIncs) {
                return
            }
            let interval = page.get().interval / 2
            let numIncs = page.get().lastNumIncs * 2
            percentChange = percentChange * 3

            page.set({lastNumIncs: numIncs})
            setIntrvl(page, interval, direction, numIncs, numReIncs, percentChange)
        } else {
            page.set({numIncs})
        }
    }

    function setIntrvl(
        page,
        interval,
        direction,
        numIncs,
        numReIncs,
        percentChange,
    ) {
        // console.log(`interval: ${interval}, direction: ${direction}, numIncs: ${numIncs}, numReIncs: ${numReIncs}, percentChange: ${percentChange}`)

        const incrementInterval = setInterval(() => {
            checkInterval(page)
        }, interval)

        page.set({direction, incrementInterval, interval, numIncs, numReIncs, percentChange})
    }

    function clearIntrvl(
        page
    ) {
        let incrementInterval = page.get().incrementInterval

        if(incrementInterval) {
            clearInterval(incrementInterval);
        }
    }

    function getInputBorder(
        dimension
    ) {
        return dimension.valid
        ? '0px'
        : '3px solid red'
    }

    function getRadius(
        dir,
        dimension
    ) {
        return dir === dimension.dir
        ? 24
        : 23
    }

    function getStrokeWidth(
        dir,
        dimension
    ) {
        return dir === dimension.dir
        ? 0
        : 3
    }

    function getColor(
        dir,
        dimension
    ) {
        return dir === dimension.dir
        ? dimension.color
        : 'FFFFFF'
    }
</script>
